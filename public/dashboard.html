<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ETH Supreme Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0d1117;
      color: #f0f6fc;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
    }
    canvas {
      background-color: #161b22;
      border-radius: 8px;
      padding: 1rem;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
  </style>
</head>
<body>
  <img src="brain_gold_logo.png" alt="Focus Mode Logo" style="display: block; margin: 0 auto 1rem; height: 80px; animation: float 3s ease-in-out infinite;">
  <h1>üß† FOCUS MODE ‚Äì ETH Supreme Dashboard</h1>
  <div style="text-align: center; font-size: 0.95rem; color: #c9d1d9; margin-bottom: 1.5rem;">
    <p>Este dashboard muestra en tiempo real:</p>
    <ul style="list-style: none; padding-left: 0;">
      <li><strong>üü¢ Precio ETH Real</strong>: datos reales actuales desde Kraken</li>
      <li><strong>üü° Predicci√≥n ETH</strong>: estimaciones del bot para 1 a 5 d√≠as basado en volumen y estrategia</li>
      <li><strong>üìä Volumen ETH</strong>: barras que indican actividad de compra/venta en cada intervalo</li>
      <li><strong>üì° Estado del Bot</strong>: actividad reciente del bot reportada desde Kraken</li>
      <li><strong>üîµ EMA</strong>: Media m√≥vil exponencial que suaviza las variaciones de precio.</li>
      <li><strong>üî¥ RSI</strong>: √çndice de fuerza relativa que indica zonas de sobrecompra o sobreventa.</li>
    </ul>
    <p style="font-size: 0.85rem; color: #8b949e;">
      <strong>üü¢ Precio ETH Real</strong>: L√≠nea continua verde que representa los valores reales de ETH seg√∫n el exchange Kraken.
      <br>
      <strong>üü° Predicci√≥n ETH</strong>: L√≠nea discontinua dorada, basada en an√°lisis del bot usando volumen y l√≥gica avanzada, proyectando hasta 5 d√≠as.
      <br>
      <strong>üìä Volumen ETH</strong>: Barras azules que indican el nivel de actividad de trading por momento. Alto volumen sugiere m√°s presi√≥n de compra o venta.
      <br>
      <strong>üì° Estado del Bot</strong>: √öltima acci√≥n reportada por el bot; puede incluir compras, ventas, se√±ales, o estado de inactividad.
      <br>
      <strong>üîµ EMA</strong>: Curva azul que representa la media m√≥vil exponencial, usada para detectar tendencias.
      <br>
      <strong>üî¥ RSI</strong>: Curva roja que marca niveles de sobrecompra/sobreventa para identificar posibles giros.
    </p>
  </div>
  <div style="text-align: center; margin-bottom: 2rem;">
    <label for="rangeSelect" style="margin-right: 0.5rem;">Ver rango de predicci√≥n:</label>
    <select id="rangeSelect" onchange="fetchData()">
      <option value="1">1 D√≠a</option>
      <option value="3">3 D√≠as</option>
      <option value="5" selected>5 D√≠as</option>
    </select>
  </div>
  <canvas id="ethChart" width="800" height="400"></canvas>
  <canvas id="volumeChart" width="800" height="200" style="margin-top: 2rem;"></canvas>
  <div id="botStatus" style="margin-top: 2rem; text-align: center; font-size: 1.2rem;">
    <span>üì° Estado del Bot: <strong id="statusText">Cargando...</strong></span>
  </div>
  <script>
    async function fetchData() {
      const range = document.getElementById('rangeSelect')?.value || 5;
      const response = await fetch('./eth_prediction.json');
      const data = await response.json();

      const slicedData = data.slice(0, range * 24); // 24 datos por d√≠a
      const dates = slicedData.map(item => item.timestamp);
      const prices = slicedData.map(item => item.price);
      const predictions = slicedData.map(item => item.prediction);
      const volumes = slicedData.map(item => item.volume || 0);

      const ethCtx = document.getElementById('ethChart').getContext('2d');
      const volumeCtx = document.getElementById('volumeChart').getContext('2d');

      if (window.ethChart) window.ethChart.destroy();
      if (window.volumeChart) window.volumeChart.destroy();

      const ema = slicedData.map(item => item.ema || null);
      const rsi = slicedData.map(item => item.rsi || null);

      window.ethChart = new Chart(ethCtx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [
            {
              label: 'Precio ETH Real',
              data: prices,
              borderColor: 'rgba(0, 255, 132, 1)',
              backgroundColor: 'rgba(0, 255, 132, 0.1)',
              tension: 0.3
            },
            {
              label: 'Predicci√≥n ETH',
              data: predictions,
              borderColor: 'rgba(255, 215, 0, 1)',
              backgroundColor: 'rgba(255, 215, 0, 0.1)',
              borderDash: [5, 5],
              tension: 0.3
            },
            {
              label: 'EMA',
              data: ema,
              borderColor: 'rgba(0, 123, 255, 1)',
              backgroundColor: 'rgba(0, 123, 255, 0.1)',
              tension: 0.3
            },
            {
              label: 'RSI',
              data: rsi,
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.1)',
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: '#f0f6fc'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#f0f6fc'
              }
            },
            y: {
              ticks: {
                color: '#f0f6fc'
              }
            }
          }
        }
      });

      window.volumeChart = new Chart(volumeCtx, {
        type: 'bar',
        data: {
          labels: dates,
          datasets: [{
            label: 'Volumen ETH',
            data: volumes,
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: '#f0f6fc'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#f0f6fc'
              }
            },
            y: {
              ticks: {
                color: '#f0f6fc'
              }
            }
          }
        }
      });
    }

    async function fetchBotStatus() {
      try {
        const res = await fetch('./kraken_log.txt');
        const text = await res.text();
        const lastLine = text.trim().split('\n').pop();
        document.getElementById('statusText').innerText = lastLine || "Sin actividad reciente";
      } catch {
        document.getElementById('statusText').innerText = "Sin conexi√≥n";
      }
    }

    setInterval(fetchBotStatus, 3000); // Actualiza cada 3 segundos
    fetchBotStatus();

    setInterval(fetchData, 60000); // Refresca los datos cada 60 segundos
    fetchData();
  </script>
</body>
</html>
